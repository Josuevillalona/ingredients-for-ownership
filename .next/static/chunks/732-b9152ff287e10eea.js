"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[732],{6463:function(e,t,r){var n=r(1169);r.o(n,"useParams")&&r.d(t,{useParams:function(){return n.useParams}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},7516:function(e,t,r){r.d(t,{i:function(){return c}});var n=r(7437),o=r(6410),a=r(6463),s=r(2265);function c(e){let{children:t,redirectTo:r="/login",fallback:c=(0,n.jsx)(i,{})}=e,{user:u,loading:d}=(0,o.a)(),l=(0,a.useRouter)();return((0,s.useEffect)(()=>{d||u||l.push(r)},[u,d,l,r]),d)?c:u?(0,n.jsx)(n.Fragment,{children:t}):null}function i(){return(0,n.jsx)("div",{className:"min-h-screen bg-brand-cream flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"w-16 h-16 bg-brand-gold rounded-full mx-auto mb-4 flex items-center justify-center animate-pulse",children:(0,n.jsx)("span",{className:"text-brand-white font-prompt font-bold text-2xl",children:"I"})}),(0,n.jsx)("p",{className:"text-brand-dark/60 font-prompt",children:"Loading..."})]})})}},6410:function(e,t,r){r.d(t,{AuthProvider:function(){return h},a:function(){return l}});var n=r(7437),o=r(2265),a=r(5735),s=r(9842),c=r(5419);class i{async signIn(e,t){try{return(await (0,a.e5)(c.I,e,t)).user}catch(e){throw Error(this.getAuthErrorMessage(e.code))}}async createCoach(e,t,r){try{let n=await (0,a.Xb)(c.I,e,t),o={email:e,name:r,createdAt:s.EK.now(),preferences:{colorCodingStyle:"standard"}};await (0,s.pl)((0,s.JU)(c.db,"coaches",n.user.uid),o)}catch(e){throw Error(this.getAuthErrorMessage(e.code))}}async signOut(){try{await (0,a.w7)(c.I)}catch(e){throw Error("Failed to sign out. Please try again.")}}async getCoachProfile(e){try{let t=(0,s.JU)(c.db,"coaches",e),r=await (0,s.QT)(t);if(r.exists())return{id:r.id,...r.data()};return null}catch(e){return console.error("Error fetching coach profile:",e),null}}onAuthStateChange(e){return(0,a.Aj)(c.I,e)}getCurrentUser(){return c.I.currentUser}getAuthErrorMessage(e){switch(e){case"auth/user-not-found":return"No account found with this email address.";case"auth/wrong-password":return"Incorrect password. Please try again.";case"auth/email-already-in-use":return"An account with this email already exists.";case"auth/weak-password":return"Password should be at least 6 characters long.";case"auth/invalid-email":return"Please enter a valid email address.";case"auth/too-many-requests":return"Too many failed attempts. Please try again later.";default:return"An error occurred during authentication. Please try again."}}}let u=new i,d=(0,o.createContext)(void 0);function l(){let e=(0,o.useContext)(d);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function h(e){let{children:t}=e,[r,a]=(0,o.useState)(null),[s,c]=(0,o.useState)(null),[i,l]=(0,o.useState)(!0);(0,o.useEffect)(()=>u.onAuthStateChange(async e=>{if(a(e),e)try{let t=await u.getCoachProfile(e.uid);c(t)}catch(e){console.error("Error fetching coach profile:",e),c(null)}else c(null);l(!1)}),[]);let h=async(e,t)=>{l(!0);try{await u.signIn(e,t)}catch(e){throw l(!1),e}},g=async(e,t,r)=>{l(!0);try{await u.createCoach(e,t,r),await u.signIn(e,t)}catch(e){throw l(!1),e}},f=async()=>{l(!0);try{await u.signOut()}catch(e){throw l(!1),e}},m=async()=>{if(r)try{let e=await u.getCoachProfile(r.uid);c(e)}catch(e){console.error("Error refreshing coach profile:",e)}};return(0,n.jsx)(d.Provider,{value:{user:r,coach:s,loading:i,signIn:h,signUp:g,signOut:f,refreshCoachProfile:m},children:t})}},6760:function(e,t,r){r.d(t,{z:function(){return a}});var n=r(7437);r(2265);var o=r(4839);function a(e){let{variant:t="primary",size:r="md",children:a,isLoading:s=!1,disabled:c,className:i,...u}=e;return(0,n.jsx)("button",{className:(0,o.W)("font-prompt font-medium transition-all duration-200 focus:ring-2 focus:ring-brand-focus focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed",{primary:"bg-brand-gold text-brand-dark hover:bg-brand-hover disabled:hover:bg-brand-gold",secondary:"bg-brand-dark text-brand-white hover:bg-brand-dark/90",outline:"border-2 border-brand-gold text-brand-gold hover:bg-brand-gold hover:text-brand-dark",ghost:"text-brand-gold hover:bg-brand-gold/10"}[t],{sm:"px-3 py-1.5 text-sm rounded-md min-h-[36px]",md:"px-4 py-2 text-base rounded-lg min-h-[44px] touch-target",lg:"px-6 py-3 text-lg rounded-lg min-h-[52px]"}[r],i),disabled:c||s,...u,children:s?(0,n.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,n.jsx)("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),(0,n.jsx)("span",{children:"Loading..."})]}):a})}},5419:function(e,t,r){r.d(t,{I:function(){return i},db:function(){return c}});var n=r(5236),o=r(9842),a=r(5735);let s=(0,n.ZF)({apiKey:"AIzaSyBQZagyMTpFNsoSOh4cKT8PVV_xbCuiX8s",authDomain:"ingredients-for-ownershi-81eaf.firebaseapp.com",projectId:"ingredients-for-ownershi-81eaf",storageBucket:"ingredients-for-ownershi-81eaf.firebasestorage.app",messagingSenderId:"855662446831",appId:"1:855662446831:web:deff590004f93f5cec731a"}),c=(0,o.ad)(s),i=(0,a.v0)(s)},7206:function(e,t,r){r.d(t,{H:function(){return h}});var n=r(9842),o=r(5419),a=r(1727);let s=e=>crypto.getRandomValues(new Uint8Array(e)),c=(e,t,r)=>{let n=(2<<Math.log2(e.length-1))-1,o=-~(1.6*n*t/e.length);return (a=t)=>{let s="";for(;;){let t=r(o),c=0|o;for(;c--;)if((s+=e[t[c]&n]||"").length>=a)return s}}},i=(e,t=21)=>c(e,0|t,s),u=(e=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&r[e]];return t};class d{static generateToken(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:21;return u(e)}static generateShortToken(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12;return u(e)}static isValidToken(e){return!!e&&"string"==typeof e&&!(e.length<8)&&!(e.length>50)&&/^[A-Za-z0-9_-]+$/.test(e)}static generateCustomToken(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:21;return i(e,t)()}static generateNumericToken(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8;return this.generateCustomToken("0123456789",e)}}let l=d.generateToken;d.generateShortToken,d.isValidToken,d.generateNumericToken;class h{async createDocument(e,t){try{let r=l(),a=(0,n.Bt)(),s={...t,coachId:e,shareToken:r,createdAt:a,updatedAt:a};console.log("Creating ingredient document with data:",{clientName:s.clientName,coachId:s.coachId,status:s.status,ingredientsCount:s.ingredients.length,shareToken:s.shareToken});let c=await (0,n.ET)((0,n.hJ)(o.db,this.COLLECTION_NAME),s);console.log("✅ Document created with ID:",c.id);let i=await this.getDocumentById(c.id);if(!i)throw Error("Failed to retrieve created document - document was created but retrieval failed");return console.log("✅ Document retrieved successfully with proper timestamps"),i}catch(e){throw console.error("❌ Error creating ingredient document:",e),e instanceof Error&&console.error("Error details:",{name:e.name,message:e.message,stack:e.stack}),Error("Failed to create ingredient document: ".concat(e instanceof Error?e.message:"Unknown error"))}}async getDocument(e,t){try{let r=(0,n.JU)(o.db,this.COLLECTION_NAME,e),s=await (0,n.QT)(r);if(!s.exists())return console.log("Document not found:",e),null;let c={id:s.id,...s.data()};if(c.coachId!==t)return console.log("Access denied: Coach does not own document"),null;if(!(0,a.Yl)(c))return console.error("Invalid document structure:",c),null;return c}catch(e){return console.error("❌ Error getting document:",e),null}}async getDocumentById(e){try{let t=(0,n.JU)(o.db,this.COLLECTION_NAME,e),r=await (0,n.QT)(t);if(!r.exists())return null;let s={id:r.id,...r.data()};if(!(0,a.Yl)(s))return console.error("Invalid document structure:",s),null;return s}catch(e){return console.error("❌ Error getting document by ID:",e),null}}async getDocumentByShareToken(e){try{let t=(0,n.IO)((0,n.hJ)(o.db,this.COLLECTION_NAME),(0,n.ar)("shareToken","==",e),(0,n.b9)(1)),r=await (0,n.PL)(t);if(r.empty)return console.log("Document not found for share token"),null;let s=r.docs[0],c={id:s.id,...s.data()};if(!(0,a.Yl)(c))return console.error("Invalid document structure:",c),null;return c}catch(e){return console.error("❌ Error getting document by share token:",e),null}}async getCoachDocuments(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;try{let r=(0,n.IO)((0,n.hJ)(o.db,this.COLLECTION_NAME),(0,n.ar)("coachId","==",e),(0,n.Xo)("updatedAt","desc"),(0,n.b9)(t)),s=await (0,n.PL)(r),c=[];return s.forEach(e=>{let t={id:e.id,...e.data()};(0,a.Yl)(t)&&c.push(t)}),console.log("\uD83D\uDCCB Retrieved ".concat(c.length," documents for coach ").concat(e)),c}catch(e){return console.error("❌ Error getting coach documents:",e),[]}}async updateDocument(e,t,r){try{if(!await this.getDocument(e,t))return console.log("Cannot update: Document not found or access denied"),null;let a=(0,n.JU)(o.db,this.COLLECTION_NAME,e),s={...r,updatedAt:(0,n.Bt)()};return await (0,n.r7)(a,s),await this.getDocument(e,t)}catch(e){return console.error("❌ Error updating document:",e),null}}async deleteDocument(e,t){try{if(!await this.getDocument(e,t))return console.log("Cannot delete: Document not found or access denied"),!1;let r=(0,n.JU)(o.db,this.COLLECTION_NAME,e);return await (0,n.oe)(r),console.log("✅ Document deleted successfully:",e),!0}catch(e){return console.error("❌ Error deleting document:",e),!1}}async regenerateShareToken(e,t){try{if(!await this.getDocument(e,t))return console.log("Cannot regenerate token: Document not found or access denied"),null;let r=l(),a=(0,n.JU)(o.db,this.COLLECTION_NAME,e);return await (0,n.r7)(a,{shareToken:r,updatedAt:(0,n.Bt)()}),console.log("✅ Share token regenerated successfully"),r}catch(e){return console.error("❌ Error regenerating share token:",e),null}}async searchDocuments(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20;try{let n=await this.getCoachDocuments(e,100),o=t.toLowerCase();return n.filter(e=>e.clientName.toLowerCase().includes(o)).slice(0,r)}catch(e){return console.error("❌ Error searching documents:",e),[]}}async batchCreateDocuments(e,t){try{let r=(0,n.qs)(o.db),a=[],s=(0,n.Bt)();t.forEach(t=>{let c=(0,n.JU)((0,n.hJ)(o.db,this.COLLECTION_NAME));r.set(c,{...t,coachId:e,shareToken:l(),createdAt:s,updatedAt:s}),a.push(c)}),await r.commit();let c=a.map(e=>e.id);return console.log("✅ Batch created ".concat(c.length," documents")),c}catch(e){throw console.error("❌ Error batch creating documents:",e),Error("Failed to batch create documents: ".concat(e instanceof Error?e.message:"Unknown error"))}}async updateClientTracking(e,t,r){try{console.log("\uD83D\uDD0D Updating client tracking:",{shareToken:e,foodId:t,clientChecked:r});let a=await this.getDocumentByShareToken(e);if(!a)return console.log("❌ Document not found for tracking update"),!1;if("published"!==a.status)return console.log("❌ Cannot update tracking for unpublished document"),!1;let s=a.ingredients.findIndex(e=>e.foodId===t);if(-1===s)return console.log("❌ Ingredient not found in document:",t),!1;let c=[...a.ingredients];c[s]={...c[s],clientChecked:r};let i=(0,n.JU)(o.db,this.COLLECTION_NAME,a.id);return await (0,n.r7)(i,{ingredients:c,updatedAt:(0,n.Bt)()}),console.log("✅ Client tracking updated successfully"),!0}catch(e){return console.error("❌ Error updating client tracking:",e),!1}}constructor(){this.COLLECTION_NAME="ingredient-documents"}}new h},1727:function(e,t,r){r.d(t,{Xg:function(){return a},Yl:function(){return o},bZ:function(){return s}});var n=r(9842);function o(e){let t="object"==typeof e&&"string"==typeof e.id&&"string"==typeof e.clientName&&"string"==typeof e.coachId&&(e.createdAt instanceof n.EK||null!=e.createdAt)&&(e.updatedAt instanceof n.EK||null!=e.updatedAt)&&"string"==typeof e.shareToken&&Array.isArray(e.ingredients)&&["draft","published"].includes(e.status);return t||console.log("Invalid IngredientDocument:",{hasId:"string"==typeof e.id,hasClientName:"string"==typeof e.clientName,hasCoachId:"string"==typeof e.coachId,hasCreatedAt:e.createdAt instanceof n.EK||null!=e.createdAt,hasUpdatedAt:e.updatedAt instanceof n.EK||null!=e.updatedAt,hasShareToken:"string"==typeof e.shareToken,hasIngredients:Array.isArray(e.ingredients),hasValidStatus:["draft","published"].includes(e.status),actualData:e}),t}function a(e){return"object"==typeof e&&"string"==typeof e.id&&"string"==typeof e.name&&"number"==typeof e.order&&Array.isArray(e.foods)}function s(e){return"object"==typeof e&&"string"==typeof e.id&&"string"==typeof e.name&&"string"==typeof e.categoryId}}}]);