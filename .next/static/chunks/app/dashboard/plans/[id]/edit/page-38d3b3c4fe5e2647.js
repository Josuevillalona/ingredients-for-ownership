(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[39],{3623:function(e,t,a){Promise.resolve().then(a.bind(a,7464))},7464:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return h}});var r=a(7437),n=a(2265),s=a(6463),d=a(7516),l=a(6410),o=a(6760),i=a(7138),c=a(5419),m=a(9842),x=a(7206),u=a(2976);function h(){return(0,r.jsx)(d.i,{children:(0,r.jsx)(b,{})})}function b(){let{user:e}=(0,l.a)(),t=(0,s.useRouter)(),a=(0,s.useParams)().id,[d,h]=(0,n.useState)(null),[b,p]=(0,n.useState)([]),[g,f]=(0,n.useState)([]),[j,v]=(0,n.useState)(new Map),[N,w]=(0,n.useState)(""),[y,k]=(0,n.useState)(!0),[C,S]=(0,n.useState)(!1),[E,I]=(0,n.useState)(null),P=new x.H;(0,n.useEffect)(()=>{e&&a&&L()},[e,a]);let L=async()=>{if(e)try{k(!0),I(null);let t=await P.getDocument(a,e.uid);if(!t){I("Document not found or you do not have permission to edit it.");return}h(t),w(t.clientName);let r=(0,m.IO)((0,m.hJ)(c.db,"food-categories"),(0,m.Xo)("order","asc")),n=(await (0,m.PL)(r)).docs.map(e=>({id:e.id,...e.data()})),s=(0,m.IO)((0,m.hJ)(c.db,"foods")),d=(await (0,m.PL)(s)).docs.map(e=>({id:e.id,...e.data()}));p(n),f(d);let l=new Map;d.forEach(e=>{l.set(e.id,"none")}),t.ingredients.forEach(e=>{let t="none";e.isSelected&&"blue"===e.colorCode?t="approved":"yellow"===e.colorCode?t="neutral":"red"===e.colorCode&&(t="avoid"),l.set(e.foodId,t)}),v(l)}catch(e){console.error("Error loading document and food data:",e),I("Failed to load document data. Please try again.")}finally{k(!1)}},M=async()=>{if(!e||!N||!d){alert("Please enter a client name before saving.");return}let r=g.filter(e=>{let t=j.get(e.id);return t&&"none"!==t});if(0===r.length){alert("Please select at least one food before saving.");return}S(!0);try{let n=r.map(e=>{let t=j.get(e.id)||"none",a=null,r=!1;return"approved"===t?(a="blue",r=!0):"neutral"===t?(a="yellow",r=!0):"avoid"===t&&(a="red",r=!0),{foodId:e.id,categoryId:e.categoryId||"",colorCode:a,isSelected:r,notes:"Coach marked as: ".concat(t)}});console.log("Updating document with data:",{clientName:N,ingredients:n,status:"published"}),await P.updateDocument(a,e.uid,{clientName:N,ingredients:n,status:"published"})?t.push("/dashboard/plans/".concat(a)):alert("Failed to update document. Please try again.")}catch(e){console.error("Error updating document:",e),alert("Failed to update document. Please try again.")}finally{S(!1)}};if(y)return(0,r.jsx)("div",{className:"min-h-screen bg-brand-cream flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-brand-gold rounded-full mx-auto mb-4 flex items-center justify-center animate-pulse",children:(0,r.jsx)("span",{className:"text-brand-white font-prompt font-bold text-2xl",children:"I"})}),(0,r.jsx)("p",{className:"text-brand-dark/60 font-prompt",children:"Loading plan for editing..."})]})});if(E||!d)return(0,r.jsx)("div",{className:"min-h-screen bg-brand-cream flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center max-w-md",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-red-500 rounded-full mx-auto mb-4 flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-white font-prompt font-bold text-2xl",children:"!"})}),(0,r.jsx)("h2",{className:"font-prompt font-bold text-xl text-brand-dark mb-2",children:"Cannot Edit Plan"}),(0,r.jsx)("p",{className:"text-brand-dark/60 font-prompt mb-4",children:E}),(0,r.jsx)(i.default,{href:"/dashboard",children:(0,r.jsx)(o.z,{variant:"primary",children:"Back to Dashboard"})})]})});let H=(()=>{let e={approved:0,neutral:0,avoid:0,none:0};return Array.from(j.values()).forEach(t=>{e[t]++}),e})();return(0,r.jsxs)("div",{className:"min-h-screen bg-brand-cream",children:[(0,r.jsx)("header",{className:"bg-brand-dark shadow-lg border-b border-brand-gold/20",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"flex items-center space-x-3",children:(0,r.jsx)(i.default,{href:"/dashboard/plans/".concat(a),className:"text-brand-white/70 hover:text-brand-white",children:"← Back to Plan"})}),(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"w-8 h-8 bg-brand-gold rounded-lg flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-brand-white font-prompt font-bold text-lg",children:"I"})}),(0,r.jsx)("h1",{className:"text-brand-white font-prompt font-bold text-2xl",children:"Edit Nutrition Plan"})]})]})})}),(0,r.jsx)("div",{className:"bg-brand-white border-b border-brand-gold/20",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex-1 max-w-md",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-brand-dark mb-2 font-prompt",children:"Client Name"}),(0,r.jsx)("input",{type:"text",value:N,onChange:e=>w(e.target.value),className:"w-full px-4 py-3 border border-brand-gold/20 rounded-xl bg-brand-white   focus:outline-none focus:ring-2 focus:ring-brand-gold focus:border-transparent   font-prompt text-brand-dark placeholder-brand-dark/40",placeholder:"Enter client's name"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-6 text-sm font-prompt",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),(0,r.jsxs)("span",{className:"text-brand-dark",children:["Approved: ",H.approved]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),(0,r.jsxs)("span",{className:"text-brand-dark",children:["Neutral: ",H.neutral]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),(0,r.jsxs)("span",{className:"text-brand-dark",children:["Avoid: ",H.avoid]})]})]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)(o.z,{variant:"secondary",onClick:()=>t.push("/dashboard/plans/".concat(a)),children:"Cancel"}),(0,r.jsx)(o.z,{variant:"primary",onClick:M,isLoading:C,disabled:!N||H.approved+H.neutral+H.avoid===0,children:C?"Saving...":"Update Plan"})]})]})})}),(0,r.jsx)(u.gS,{foods:g.map(e=>({id:e.id,name:e.name,status:j.get(e.id)||"none",categoryId:e.categoryId,nutritionalHighlights:e.nutritionalHighlights})),categories:b.map(e=>({id:e.id,title:e.name,order:e.order})),onStatusChange:(e,t)=>{v(a=>{let r=new Map(a);return r.set(e,t),r})}})]})}},2976:function(e,t,a){"use strict";a.d(t,{gS:function(){return c}});var r=a(7437),n=a(2265);function s(e){let{searchTerm:t,onSearchChange:a,placeholder:n="Search foods..."}=e;return(0,r.jsxs)("div",{className:"relative mb-6",children:[(0,r.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,r.jsx)("svg",{className:"w-5 h-5 text-brand-dark/40",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),(0,r.jsx)("input",{type:"text",value:t,onChange:e=>a(e.target.value),placeholder:n,className:"w-full pl-10 pr-4 py-3 border border-brand-gold/20 rounded-xl bg-brand-white/90 backdrop-blur-sm   focus:outline-none focus:ring-2 focus:ring-brand-gold focus:border-transparent   font-prompt text-brand-dark placeholder-brand-dark/40   transition-all duration-200"})]})}function d(e){let{categories:t,selectedCategory:a,onCategorySelect:n}=e,s=[...t].sort((e,t)=>e.order-t.order);return(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,r.jsx)("button",{onClick:()=>n(void 0),className:"px-4 py-2 rounded-lg font-prompt font-medium transition-all duration-200 text-sm\n            ".concat(a?"bg-brand-white/70 text-brand-dark hover:bg-brand-white border border-brand-gold/20":"bg-brand-gold text-brand-white shadow-md"),children:"All Categories"}),s.map(e=>(0,r.jsx)("button",{onClick:()=>n(e.id),className:"px-4 py-2 rounded-lg font-prompt font-medium transition-all duration-200 text-sm\n              ".concat(a===e.id?"bg-brand-gold text-brand-white shadow-md":"bg-brand-white/70 text-brand-dark hover:bg-brand-white border border-brand-gold/20"),children:e.title},e.id))]})})}let l={approved:{bg:"bg-green-500",border:"border-green-500",text:"text-green-700",label:"Approved"},neutral:{bg:"bg-yellow-500",border:"border-yellow-500",text:"text-yellow-700",label:"Neutral"},avoid:{bg:"bg-red-500",border:"border-red-500",text:"text-red-700",label:"Avoid"},none:{bg:"bg-gray-200",border:"border-gray-300",text:"text-gray-500",label:"Not Set"}};function o(e){let{food:t,onStatusChange:a}=e,n=t.status,s=l[n],d=e=>{a(t.id,e)};return(0,r.jsxs)("div",{className:"bg-brand-white/90 backdrop-blur-sm rounded-xl border border-brand-gold/20 p-4    hover:shadow-md transition-all duration-200 group",children:[(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("h3",{className:"font-prompt font-semibold text-brand-dark text-lg leading-tight",children:t.name}),t.nutritionalHighlights&&t.nutritionalHighlights.length>0&&(0,r.jsx)("p",{className:"text-sm text-brand-dark/60 font-prompt mt-1",children:t.nutritionalHighlights.join(", ")})]}),(0,r.jsx)("div",{className:"mb-3",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(s.bg)}),(0,r.jsx)("span",{className:"text-sm font-prompt font-medium ".concat(s.text),children:s.label})]})}),(0,r.jsx)("div",{className:"grid grid-cols-3 gap-1",children:["approved","neutral","avoid"].map(e=>{let t=l[e],a=n===e;return(0,r.jsx)("button",{onClick:()=>d(e),className:"p-2 rounded-lg text-xs font-prompt font-medium transition-all duration-200\n                ".concat(a?"".concat(t.bg," text-white shadow-sm"):"bg-gray-100 ".concat(t.text," hover:bg-gray-200 border ").concat(t.border,"/30")),children:t.label},e)})})]})}function i(e){let{category:t,foods:a,onStatusChange:n}=e;return 0===a.length?null:(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,r.jsx)("div",{className:"w-2 h-8 bg-brand-gold rounded-full"}),(0,r.jsx)("h2",{className:"font-prompt font-bold text-2xl text-brand-dark",children:t.title}),(0,r.jsxs)("span",{className:"bg-brand-gold/20 text-brand-dark font-prompt font-medium text-sm px-3 py-1 rounded-full",children:[a.length," items"]})]}),(0,r.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:a.map(e=>(0,r.jsx)(o,{food:e,onStatusChange:n},e.id))})]})}function c(e){var t;let{foods:a,categories:l,onStatusChange:o}=e,[c,m]=(0,n.useState)(""),[x,u]=(0,n.useState)(),h=(0,n.useMemo)(()=>{let e=a;if(c.trim()){let t=c.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(t)||e.nutritionalHighlights&&e.nutritionalHighlights.some(e=>e.toLowerCase().includes(t)))}return x&&(e=e.filter(e=>e.categoryId===x)),e},[a,c,x]),b=(0,n.useMemo)(()=>{let e=new Map;return l.forEach(t=>{e.set(t.id,[])}),h.forEach(t=>{let a=e.get(t.categoryId)||[];a.push(t),e.set(t.categoryId,a)}),e},[h,l]),p=(0,n.useMemo)(()=>[...l].sort((e,t)=>e.order-t.order),[l]);return(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h1",{className:"font-prompt font-bold text-3xl text-brand-dark mb-2",children:"Food Selection Guide"}),(0,r.jsx)("p",{className:"text-brand-dark/60 font-prompt",children:"Choose foods and set their status for your client's nutrition plan"})]}),(0,r.jsx)(s,{searchTerm:c,onSearchChange:m,placeholder:"Search foods by name or nutritional highlights..."}),(0,r.jsx)(d,{categories:l,selectedCategory:x,onCategorySelect:u}),(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-brand-dark/60 font-prompt",children:[(0,r.jsxs)("span",{children:["Showing ",h.length," foods"]}),c&&(0,r.jsxs)("span",{children:['• Search: "',c,'"']}),x&&(0,r.jsxs)("span",{children:["• Category: ",null===(t=l.find(e=>e.id===x))||void 0===t?void 0:t.title]})]})}),(0,r.jsx)("div",{className:"space-y-8",children:p.map(e=>{let t=b.get(e.id)||[];return(0,r.jsx)(i,{category:e,foods:t,onStatusChange:o},e.id)})}),0===h.length&&(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-brand-gold/20 rounded-full mx-auto mb-4 flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-8 h-8 text-brand-gold",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),(0,r.jsx)("h3",{className:"font-prompt font-bold text-xl text-brand-dark mb-2",children:"No foods found"}),(0,r.jsx)("p",{className:"text-brand-dark/60 font-prompt mb-4",children:"Try adjusting your search terms or category filter."}),(c||x)&&(0,r.jsx)("button",{onClick:()=>{m(""),u(void 0)},className:"bg-brand-gold text-brand-white px-6 py-2 rounded-lg font-prompt font-medium   hover:bg-brand-gold/90 transition-colors duration-200",children:"Clear Filters"})]})]})}}},function(e){e.O(0,[358,139,990,836,38,732,971,23,744],function(){return e(e.s=3623)}),_N_E=e.O()}]);