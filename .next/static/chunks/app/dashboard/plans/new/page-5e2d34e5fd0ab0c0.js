(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[330],{519:function(e,t,s){Promise.resolve().then(s.bind(s,5406))},6463:function(e,t,s){"use strict";var a=s(1169);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},5406:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return h}});var a=s(7437),r=s(2265),l=s(6760),n=s(4977),i=s(5639),o=s(1602),d=s(6976);function c(e){let{selectedClientId:t,onPlanCreated:s}=e,{foods:c,loading:m,loadFoods:u}=(0,o.x)(),{clients:h,isLoading:g}=(0,d.a)(),[x,f]=(0,r.useState)(null),[b,p]=(0,r.useState)(""),[w,y]=(0,r.useState)({}),[v,j]=(0,r.useState)(""),[N,C]=(0,r.useState)("all"),[S,k]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(t&&h.length>0){let e=h.find(e=>e.id===t);e&&(f(e),p("Nutrition Plan for ".concat(e.name)))}},[t,h]);let P=c.filter(e=>{let t=e.name.toLowerCase().includes(v.toLowerCase())||e.tags.some(e=>e.toLowerCase().includes(v.toLowerCase())),s="all"===N||e.category===N;return t&&s}),E={blue:P.filter(e=>"blue"===e.category),yellow:P.filter(e=>"yellow"===e.category),red:P.filter(e=>"red"===e.category)},F=e=>{let t=e.id;if(w[t]){let e={...w};delete e[t],y(e)}else{let s={foodId:e.id,foodName:e.name,category:e.category,servingSize:e.servingSize,mealType:"breakfast",notes:""};y(e=>({...e,[t]:s}))}},L=async e=>{await u(),setTimeout(()=>{let t=c.find(t=>t.id===e);t&&F(t)},100),k(!1)},U=async()=>{if(!x){alert("Please select a client");return}if(0===Object.keys(w).length){alert("Please select at least one food item");return}console.log("Creating plan:",{clientId:x.id,title:b,foods:Object.values(w)}),s&&s("new-plan-id")},z=Object.keys(w).length;return m||g?(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-gold mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading..."})]})}):S?(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Add Food to Plan"}),(0,a.jsx)(l.z,{variant:"outline",onClick:()=>k(!1),children:"Back to Plan"})]}),(0,a.jsx)(i.f,{onSuccess:L,onCancel:()=>k(!1),onManualAdd:()=>{console.log("Manual add requested during plan creation")}})]})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Create Nutrition Plan"}),!t&&(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Client"}),(0,a.jsxs)("select",{value:(null==x?void 0:x.id)||"",onChange:e=>{let t=h.find(t=>t.id===e.target.value);f(t||null),t&&p("Nutrition Plan for ".concat(t.name))},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-gold focus:border-brand-gold",children:[(0,a.jsx)("option",{value:"",children:"Choose a client..."}),h.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Plan Title"}),(0,a.jsx)("input",{type:"text",value:b,onChange:e=>p(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-gold focus:border-brand-gold",placeholder:"Enter plan title..."})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[z," food",1!==z?"s":""," selected"]}),(0,a.jsxs)(l.z,{onClick:U,disabled:!x||!b.trim()||0===z,children:["Create Plan (",z,")"]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Select Foods for Plan"}),(0,a.jsxs)("div",{className:"flex gap-3 items-center",children:[(0,a.jsx)("div",{className:"flex-1 max-w-md",children:(0,a.jsx)("input",{type:"text",value:v,onChange:e=>j(e.target.value),placeholder:"Search foods...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-gold focus:border-brand-gold"})}),(0,a.jsx)(l.z,{variant:"outline",onClick:()=>k(!0),className:"whitespace-nowrap",children:"+ Add New Food"})]})]}),(0,a.jsxs)("div",{className:"flex gap-2 mb-6 overflow-x-auto",children:[(0,a.jsxs)("button",{onClick:()=>C("all"),className:"px-4 py-2 text-sm font-medium rounded-lg whitespace-nowrap transition-colors ".concat("all"===N?"bg-brand-gold text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:["All Foods (",P.length,")"]}),(0,a.jsxs)("button",{onClick:()=>C("blue"),className:"px-4 py-2 text-sm font-medium rounded-lg whitespace-nowrap transition-colors ".concat("blue"===N?"bg-blue-600 text-white":"bg-blue-100 text-blue-700 hover:bg-blue-200"),children:["Blue Foods (",E.blue.length,")"]}),(0,a.jsxs)("button",{onClick:()=>C("yellow"),className:"px-4 py-2 text-sm font-medium rounded-lg whitespace-nowrap transition-colors ".concat("yellow"===N?"bg-yellow-600 text-white":"bg-yellow-100 text-yellow-700 hover:bg-yellow-200"),children:["Yellow Foods (",E.yellow.length,")"]}),(0,a.jsxs)("button",{onClick:()=>C("red"),className:"px-4 py-2 text-sm font-medium rounded-lg whitespace-nowrap transition-colors ".concat("red"===N?"bg-red-600 text-white":"bg-red-100 text-red-700 hover:bg-red-200"),children:["Red Foods (",E.red.length,")"]})]}),(0,a.jsx)("div",{className:"space-y-6",children:Object.entries(E).map(e=>{let[t,s]=e;return"all"!==N&&N!==t||0===s.length?null:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,a.jsxs)(n.r,{category:t,children:[t.charAt(0).toUpperCase()+t.slice(1)," Foods"]}),(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:["(",s.length," foods)"]})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:s.map(e=>{let t=!!w[e.id];return(0,a.jsxs)("div",{onClick:()=>F(e),className:"\n                          p-4 border-2 rounded-lg cursor-pointer transition-all\n                          ".concat(t?"border-brand-gold bg-brand-cream shadow-md":"border-gray-200 hover:border-gray-300 hover:shadow-sm","\n                        "),children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 text-sm leading-tight",children:e.name}),(0,a.jsx)("div",{className:"ml-2 flex-shrink-0",children:(0,a.jsx)("div",{className:"\n                              w-5 h-5 rounded border-2 flex items-center justify-center\n                              ".concat(t?"bg-brand-gold border-brand-gold":"border-gray-300","\n                            "),children:t&&(0,a.jsx)("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})})]}),e.servingSize&&(0,a.jsxs)("p",{className:"text-xs text-gray-600 mb-1",children:[(0,a.jsx)("span",{className:"font-medium",children:"Serving:"})," ",e.servingSize]}),e.description&&(0,a.jsx)("p",{className:"text-xs text-gray-500 line-clamp-2",children:e.description})]},e.id)})})]},t)})}),0===P.length&&(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("p",{className:"text-gray-500 mb-4",children:v?'No foods found matching "'.concat(v,'"'):"No foods available"}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[v&&(0,a.jsx)(l.z,{variant:"secondary",onClick:()=>j(""),children:"Clear Search"}),(0,a.jsx)(l.z,{onClick:()=>k(!0),className:"bg-brand-gold hover:bg-brand-gold/90",children:"+ Add New Food"})]})]})]}),z>0&&(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Selected Foods (",z,")"]}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:Object.values(w).map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(n.r,{category:e.category,size:"sm",children:e.category.charAt(0).toUpperCase()}),(0,a.jsx)("span",{className:"text-sm font-medium",children:e.foodName})]}),(0,a.jsx)("button",{onClick:()=>{let t={...w};delete t[e.foodId],y(t)},className:"text-red-600 hover:text-red-800 text-sm",children:"Remove"})]},e.foodId))})]})]})}var m=s(6463);function u(){let e=(0,m.useSearchParams)().get("clientId");return(0,a.jsxs)("div",{className:"min-h-screen bg-brand-cream",children:[(0,a.jsx)("header",{className:"bg-brand-dark shadow-lg border-b border-brand-gold/20",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-6",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-brand-gold rounded-lg flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-brand-white font-prompt font-bold text-lg",children:"\uD83D\uDCCB"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-brand-white font-prompt font-bold text-2xl",children:"Create Nutrition Plan"}),(0,a.jsx)("p",{className:"text-brand-white/80 text-sm",children:"Build a comprehensive one-pager nutrition guide"})]})]})})}),(0,a.jsx)("main",{className:"max-w-7xl mx-auto px-4 py-8",children:(0,a.jsx)(c,{selectedClientId:e||void 0,onPlanCreated:e=>{console.log("Plan created:",e),alert("Plan created successfully!")}})})]})}function h(){return(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)("div",{className:"min-h-screen bg-brand-cream flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-2 border-brand-gold border-t-transparent rounded-full"})}),children:(0,a.jsx)(u,{})})}},3196:function(e,t,s){"use strict";s.d(t,{T:function(){return n}});var a=s(9842),r=s(5419);class l{async createClient(e,t){try{var s,l;let n=(0,a.JU)((0,a.hJ)(r.db,this.collectionName)),i=n.id,o={coachId:e,name:t.name.trim(),sessionNotes:(null===(s=t.sessionNotes)||void 0===s?void 0:s.trim())||"",goals:t.goals.filter(e=>e.trim().length>0),restrictions:t.restrictions.filter(e=>e.trim().length>0),createdAt:a.EK.now(),lastUpdated:a.EK.now()};return(null===(l=t.email)||void 0===l?void 0:l.trim())&&(o.email=t.email.trim()),await (0,a.pl)(n,o),i}catch(e){throw Error("Failed to create client: ".concat(e.message))}}async getClientsForCoach(e){try{let t=(0,a.IO)((0,a.hJ)(r.db,this.collectionName),(0,a.ar)("coachId","==",e),(0,a.Xo)("lastUpdated","desc"));return(await (0,a.PL)(t)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){throw Error("Failed to fetch clients: ".concat(e.message))}}async getClient(e,t){try{let s=await (0,a.QT)((0,a.JU)(r.db,this.collectionName,e));if(!s.exists())return null;let l=s.data();if(l.coachId!==t)throw Error("Access denied: Client belongs to different coach");return{id:s.id,...l}}catch(e){throw Error("Failed to fetch client: ".concat(e.message))}}async updateClient(e,t,s){try{var l,n,i;if(!await this.getClient(e,t))throw Error("Client not found or access denied");let o={lastUpdated:a.EK.now()};(null===(l=s.name)||void 0===l?void 0:l.trim())&&(o.name=s.name.trim()),void 0!==s.email&&(o.email=(null===(n=s.email)||void 0===n?void 0:n.trim())||void 0),void 0!==s.sessionNotes&&(o.sessionNotes=(null===(i=s.sessionNotes)||void 0===i?void 0:i.trim())||""),s.goals&&(o.goals=s.goals.filter(e=>e.trim().length>0)),s.restrictions&&(o.restrictions=s.restrictions.filter(e=>e.trim().length>0)),await (0,a.r7)((0,a.JU)(r.db,this.collectionName,e),o)}catch(e){throw Error("Failed to update client: ".concat(e.message))}}async deleteClient(e,t){try{if(!await this.getClient(e,t))throw Error("Client not found or access denied");await (0,a.oe)((0,a.JU)(r.db,this.collectionName,e))}catch(e){throw Error("Failed to delete client: ".concat(e.message))}}async searchClients(e,t){try{let s=await this.getClientsForCoach(e);if(!t.trim())return s;let a=t.toLowerCase();return s.filter(e=>{var t;return e.name.toLowerCase().includes(a)||(null===(t=e.email)||void 0===t?void 0:t.toLowerCase().includes(a))||e.goals.some(e=>e.toLowerCase().includes(a))})}catch(e){throw Error("Failed to search clients: ".concat(e.message))}}constructor(){this.collectionName="clients"}}let n=new l},6976:function(e,t,s){"use strict";s.d(t,{a:function(){return n}});var a=s(2265),r=s(666),l=s(3196);function n(){let{user:e}=(0,r.a)(),[t,s]=(0,a.useState)([]),[n,i]=(0,a.useState)(!1),[o,d]=(0,a.useState)(null),c=async()=>{if(e){i(!0),d(null);try{let t=await l.T.getClientsForCoach(e.uid);s(t)}catch(e){d(e.message)}finally{i(!1)}}},m=async t=>{if(!e)throw Error("User not authenticated");try{let s=await l.T.createClient(e.uid,t);return await c(),s}catch(e){throw d(e.message),e}},u=async(t,s)=>{if(!e)throw Error("User not authenticated");try{await l.T.updateClient(t,e.uid,s),await c()}catch(e){throw d(e.message),e}},h=async t=>{if(!e)throw Error("User not authenticated");try{await l.T.deleteClient(t,e.uid),await c()}catch(e){throw d(e.message),e}},g=async t=>{if(!e)return[];try{return await l.T.searchClients(e.uid,t)}catch(e){return d(e.message),[]}};return(0,a.useEffect)(()=>{c()},[e]),{clients:t,isLoading:n,error:o,createClient:m,updateClient:u,deleteClient:h,searchClients:g,refetch:c}}}},function(e){e.O(0,[358,139,990,836,367,639,971,23,744],function(){return e(e.s=519)}),_N_E=e.O()}]);