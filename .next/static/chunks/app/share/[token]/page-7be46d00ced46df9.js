(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[459],{1558:function(e,t,r){Promise.resolve().then(r.bind(r,6508))},6463:function(e,t,r){"use strict";var a=r(1169);r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},6508:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return d}});var a=r(7437),n=r(2265),s=r(6463),o=r(2668);function d(){let{document:e,foods:t,loading:r,error:d,updateTracking:l,trackingLoading:i,progressPercentage:c,progressMetrics:u}=function(e){let[t,r]=(0,n.useState)(null),[a,s]=(0,n.useState)([]),[d,l]=(0,n.useState)(!0),[i,c]=(0,n.useState)(null),[u,m]=(0,n.useState)(new Set),x=async()=>{try{l(!0),c(null);let t=await fetch("/api/share/".concat(e)),a=await t.json();if(!t.ok)throw Error(a.error||"Failed to load document");r(a.document);let n=await fetch("/api/foods");if(n.ok){let e=await n.json();s(e.foods||[])}}catch(e){console.error("Error loading shared document:",e),c(e instanceof Error?e.message:"Failed to load your nutrition plan")}finally{l(!1)}},h=async(a,n)=>{if(t){m(e=>new Set(e).add(a));try{let t=await fetch("/api/share/".concat(e,"/tracking"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({foodId:a,clientChecked:n})});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to update tracking")}r(e=>{if(!e)return e;let t=e.ingredients.map(e=>e.foodId===a?{...e,clientChecked:n}:e);return{...e,ingredients:t}})}catch(e){throw console.error("Error updating tracking:",e),e}finally{m(e=>{let t=new Set(e);return t.delete(a),t})}}};return(0,n.useEffect)(()=>{e&&x()},[e]),{document:t,foods:a,loading:d,error:i,updateTracking:h,trackingLoading:u,progressPercentage:t?(0,o.zB)(t.ingredients).percentage:0,progressMetrics:t?(0,o.zB)(t.ingredients):null,refetch:x}}((0,s.useParams)().token),m=e=>t.find(t=>t.id===e)||null,x=e=>{switch(e){case"blue":return"bg-blue-100 text-blue-800 border-blue-200";case"yellow":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"red":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},h=e=>{switch(e){case"blue":return"Unlimited";case"yellow":return"Moderate";case"red":return"Limited";default:return"Not specified"}},b=async(e,t)=>{try{await l(e,t)}catch(e){alert("Failed to update tracking. Please try again.")}};return r?(0,a.jsx)("div",{className:"min-h-screen bg-brand-cream flex items-center justify-center",children:(0,a.jsxs)("div",{className:"bg-brand-white rounded-xl p-12 shadow-sm border border-brand-gold/20 text-center max-w-md",children:[(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-2 border-brand-gold border-t-transparent rounded-full mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-brand-dark/60 font-prompt",children:"Loading your nutrition plan..."})]})}):d||!e?(0,a.jsx)("div",{className:"min-h-screen bg-brand-cream flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-brand-white rounded-xl p-12 shadow-sm border border-red-200 text-center max-w-md",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full mx-auto mb-6 flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-red-600 text-2xl",children:"⚠️"})}),(0,a.jsx)("h1",{className:"font-prompt font-bold text-xl text-brand-dark mb-4",children:"Plan Not Available"}),(0,a.jsx)("p",{className:"text-brand-dark/60 mb-6",children:d||"This nutrition plan is no longer available or the link has expired."}),(0,a.jsx)("p",{className:"text-sm text-brand-dark/50",children:"Please contact your coach for a new link."})]})}):(0,a.jsxs)("div",{className:"min-h-screen bg-brand-cream",children:[(0,a.jsx)("header",{className:"bg-brand-dark text-brand-white",children:(0,a.jsx)("div",{className:"max-w-4xl mx-auto px-4 py-6",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("h1",{className:"font-prompt font-bold text-2xl mb-2",children:["Nutrition Plan for ",e.clientName]}),(0,a.jsx)("p",{className:"text-brand-white/80 text-sm",children:"Your personalized ingredient recommendations"})]})})}),(0,a.jsx)("div",{className:"max-w-4xl mx-auto px-4 py-6",children:(0,a.jsxs)("div",{className:"bg-brand-white rounded-xl p-6 shadow-sm border border-brand-gold/20 mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"font-prompt font-bold text-lg text-brand-dark",children:"Nutrition Goals Progress"}),(0,a.jsxs)("span",{className:"text-2xl font-bold text-brand-gold",children:[c,"%"]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-3 mb-4",children:(0,a.jsx)("div",{className:"bg-brand-gold h-3 rounded-full transition-all duration-300",style:{width:"".concat(c,"%")}})}),(0,a.jsx)("p",{className:"text-sm text-brand-dark/60",children:u?(0,o.tN)(u):"Loading progress..."}),u&&u.breakdown.red.total>0&&(0,a.jsxs)("p",{className:"text-xs text-brand-dark/50 mt-2",children:[u.breakdown.red.total," awareness-only item(s) • ",u.breakdown.red.info]})]})}),(0,a.jsxs)("main",{className:"max-w-4xl mx-auto px-4 pb-8",children:[(0,a.jsx)("div",{className:"space-y-4",children:e.ingredients.map(e=>{let t=m(e.foodId),r=i.has(e.foodId);return(0,a.jsx)("div",{className:"bg-brand-white rounded-xl p-6 shadow-sm border border-brand-gold/20",children:(0,a.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,a.jsx)("div",{className:"flex-shrink-0 pt-1",children:(0,o.v8)(e.colorCode)?(0,a.jsx)("label",{className:"flex items-center cursor-pointer",children:(0,a.jsx)("input",{type:"checkbox",checked:e.clientChecked||!1,onChange:t=>b(e.foodId,t.target.checked),disabled:r,className:"w-6 h-6 text-brand-gold border-2 border-gray-300 rounded focus:ring-2 focus:ring-brand-gold focus:border-transparent disabled:opacity-50"})}):(0,a.jsx)("div",{className:"w-6 h-6 flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-xs text-red-600 font-medium border border-red-300 rounded px-1.5 py-0.5 bg-red-50",children:"ℹ️"})})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,a.jsx)("h3",{className:"font-prompt font-semibold text-lg text-brand-dark",children:(null==t?void 0:t.name)||e.foodId}),(0,a.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-medium border ".concat(x(e.colorCode)),children:h(e.colorCode)})]}),t&&(0,a.jsxs)("div",{className:"space-y-2",children:[t.nutritionalHighlights&&t.nutritionalHighlights.length>0&&(0,a.jsxs)("p",{className:"text-sm text-brand-dark/70",children:[(0,a.jsx)("strong",{children:"Benefits:"})," ",t.nutritionalHighlights.join(", ")]}),t.servingSize&&(0,a.jsxs)("p",{className:"text-sm text-brand-dark/70",children:[(0,a.jsx)("strong",{children:"Serving:"})," ",t.servingSize]})]}),e.notes&&(0,a.jsx)("div",{className:"mt-3 p-3 bg-brand-cream rounded-lg",children:(0,a.jsxs)("p",{className:"text-sm text-brand-dark/80",children:[(0,a.jsx)("strong",{children:"Coach Note:"})," ",e.notes]})}),(0,a.jsx)("div",{className:"mt-3 p-3 rounded-lg",style:{backgroundColor:"blue"===e.colorCode?"#e6f3ff":"yellow"===e.colorCode?"#fff8e6":"red"===e.colorCode?"#ffe6e6":"#f5f5f5"},children:(0,a.jsx)("p",{className:"text-sm text-brand-dark/80 italic",children:(0,o.XV)(e.colorCode)})}),r&&(0,a.jsxs)("div",{className:"mt-2 flex items-center text-sm text-brand-dark/60",children:[(0,a.jsx)("div",{className:"animate-spin w-4 h-4 border border-brand-gold border-t-transparent rounded-full mr-2"}),"Updating..."]})]})]})},e.foodId)})}),(0,a.jsx)("div",{className:"mt-12 text-center",children:(0,a.jsxs)("div",{className:"bg-brand-white rounded-xl p-6 shadow-sm border border-brand-gold/20",children:[(0,a.jsx)("p",{className:"text-sm text-brand-dark/60 mb-2",children:"Questions about your plan? Contact your coach."}),(0,a.jsxs)("p",{className:"text-xs text-brand-dark/50",children:["Last updated: ",new Date(1e3*e.updatedAt.seconds).toLocaleDateString()]})]})})]})]})}},2668:function(e,t,r){"use strict";function a(e){return"blue"===e||"yellow"===e}function n(e){let t={blue:{total:0,completed:0},yellow:{total:0,completed:0},red:{total:0,info:"For awareness only - enjoy occasionally"}};e.forEach(e=>{let{colorCode:r,clientChecked:a}=e;if(!r){console.warn("Ingredient missing color code:",e.foodId);return}switch(r){case"blue":t.blue.total++,a&&t.blue.completed++;break;case"yellow":t.yellow.total++,a&&t.yellow.completed++;break;case"red":t.red.total++;break;default:console.warn("Unknown color code: ".concat(r))}});let r=t.blue.total+t.yellow.total,a=t.blue.completed+t.yellow.completed;return{trackableCount:r,completedCount:a,percentage:r>0?Math.round(a/r*100):0,breakdown:t}}function s(e){let{completedCount:t,trackableCount:r,percentage:a}=e;return 0===r?"No nutrition goals set yet":0===t?"0 of ".concat(r," nutrition goals started"):100===a?"All ".concat(r," nutrition goals completed! \uD83C\uDF89"):"".concat(t," of ").concat(r," nutrition goals completed (").concat(a,"%)")}function o(e){switch(e){case"blue":return"Great choice! Add this to your regular rotation.";case"yellow":return"Perfect for balanced nutrition in proper portions.";case"red":return"Enjoy occasionally and in moderation. No tracking needed.";default:return"Follow your coach's guidance for this ingredient."}}r.d(t,{XV:function(){return o},tN:function(){return s},v8:function(){return a},zB:function(){return n}})}},function(e){e.O(0,[971,23,744],function(){return e(e.s=1558)}),_N_E=e.O()}]);