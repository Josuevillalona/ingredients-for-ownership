"use strict";exports.id=397,exports.ids=[397],exports.modules={86635:(e,t,r)=>{r.d(t,{db:()=>s});var n=r(29362),o=r(93820),a=r(76139);let c=(0,n.ZF)({apiKey:"AIzaSyBQZagyMTpFNsoSOh4cKT8PVV_xbCuiX8s",authDomain:"ingredients-for-ownershi-81eaf.firebaseapp.com",projectId:"ingredients-for-ownershi-81eaf",storageBucket:"ingredients-for-ownershi-81eaf.firebasestorage.app",messagingSenderId:"855662446831",appId:"1:855662446831:web:deff590004f93f5cec731a"}),s=(0,o.ad)(c);(0,a.v0)(c)},87397:(e,t,r)=>{r.d(t,{B:()=>i});var n=r(93820),o=r(86635);function a(e){let t="object"==typeof e&&"string"==typeof e.id&&"string"==typeof e.clientName&&"string"==typeof e.coachId&&(e.createdAt instanceof n.EK||null!=e.createdAt)&&(e.updatedAt instanceof n.EK||null!=e.updatedAt)&&"string"==typeof e.shareToken&&Array.isArray(e.ingredients)&&["draft","published"].includes(e.status);return t||console.log("Invalid IngredientDocument:",{hasId:"string"==typeof e.id,hasClientName:"string"==typeof e.clientName,hasCoachId:"string"==typeof e.coachId,hasCreatedAt:e.createdAt instanceof n.EK||null!=e.createdAt,hasUpdatedAt:e.updatedAt instanceof n.EK||null!=e.updatedAt,hasShareToken:"string"==typeof e.shareToken,hasIngredients:Array.isArray(e.ingredients),hasValidStatus:["draft","published"].includes(e.status),actualData:e}),t}var c=r(80088);class s{async createDocument(e,t){try{let r=(0,c.$6)(),a=(0,n.Bt)(),s={...t,coachId:e,shareToken:r,createdAt:a,updatedAt:a};console.log("Creating ingredient document with data:",{clientName:s.clientName,coachId:s.coachId,status:s.status,ingredientsCount:s.ingredients.length,shareToken:s.shareToken});let i=await (0,n.ET)((0,n.hJ)(o.db,this.COLLECTION_NAME),s);console.log("âœ… Document created with ID:",i.id);let d=await this.getDocumentById(i.id);if(!d)throw Error("Failed to retrieve created document - document was created but retrieval failed");return console.log("âœ… Document retrieved successfully with proper timestamps"),d}catch(e){throw console.error("âŒ Error creating ingredient document:",e),e instanceof Error&&console.error("Error details:",{name:e.name,message:e.message,stack:e.stack}),Error(`Failed to create ingredient document: ${e instanceof Error?e.message:"Unknown error"}`)}}async getDocument(e,t){try{let r=(0,n.JU)(o.db,this.COLLECTION_NAME,e),c=await (0,n.QT)(r);if(!c.exists())return console.log("Document not found:",e),null;let s={id:c.id,...c.data()};if(s.coachId!==t)return console.log("Access denied: Coach does not own document"),null;if(!a(s))return console.error("Invalid document structure:",s),null;return s}catch(e){return console.error("âŒ Error getting document:",e),null}}async getDocumentById(e){try{let t=(0,n.JU)(o.db,this.COLLECTION_NAME,e),r=await (0,n.QT)(t);if(!r.exists())return null;let c={id:r.id,...r.data()};if(!a(c))return console.error("Invalid document structure:",c),null;return c}catch(e){return console.error("âŒ Error getting document by ID:",e),null}}async getDocumentByShareToken(e){try{let t=(0,n.IO)((0,n.hJ)(o.db,this.COLLECTION_NAME),(0,n.ar)("shareToken","==",e),(0,n.b9)(1)),r=await (0,n.PL)(t);if(r.empty)return console.log("Document not found for share token"),null;let c=r.docs[0],s={id:c.id,...c.data()};if(!a(s))return console.error("Invalid document structure:",s),null;return s}catch(e){return console.error("âŒ Error getting document by share token:",e),null}}async getCoachDocuments(e,t=50){try{let r=(0,n.IO)((0,n.hJ)(o.db,this.COLLECTION_NAME),(0,n.ar)("coachId","==",e),(0,n.Xo)("updatedAt","desc"),(0,n.b9)(t)),c=await (0,n.PL)(r),s=[];return c.forEach(e=>{let t={id:e.id,...e.data()};a(t)&&s.push(t)}),console.log(`ðŸ“‹ Retrieved ${s.length} documents for coach ${e}`),s}catch(e){return console.error("âŒ Error getting coach documents:",e),[]}}async updateDocument(e,t,r){try{if(!await this.getDocument(e,t))return console.log("Cannot update: Document not found or access denied"),null;let a=(0,n.JU)(o.db,this.COLLECTION_NAME,e),c={...r,updatedAt:(0,n.Bt)()};return await (0,n.r7)(a,c),await this.getDocument(e,t)}catch(e){return console.error("âŒ Error updating document:",e),null}}async deleteDocument(e,t){try{if(!await this.getDocument(e,t))return console.log("Cannot delete: Document not found or access denied"),!1;let r=(0,n.JU)(o.db,this.COLLECTION_NAME,e);return await (0,n.oe)(r),console.log("âœ… Document deleted successfully:",e),!0}catch(e){return console.error("âŒ Error deleting document:",e),!1}}async regenerateShareToken(e,t){try{if(!await this.getDocument(e,t))return console.log("Cannot regenerate token: Document not found or access denied"),null;let r=(0,c.$6)(),a=(0,n.JU)(o.db,this.COLLECTION_NAME,e);return await (0,n.r7)(a,{shareToken:r,updatedAt:(0,n.Bt)()}),console.log("âœ… Share token regenerated successfully"),r}catch(e){return console.error("âŒ Error regenerating share token:",e),null}}async searchDocuments(e,t,r=20){try{let n=await this.getCoachDocuments(e,100),o=t.toLowerCase();return n.filter(e=>e.clientName.toLowerCase().includes(o)).slice(0,r)}catch(e){return console.error("âŒ Error searching documents:",e),[]}}async batchCreateDocuments(e,t){try{let r=(0,n.qs)(o.db),a=[],s=(0,n.Bt)();t.forEach(t=>{let i=(0,n.JU)((0,n.hJ)(o.db,this.COLLECTION_NAME));r.set(i,{...t,coachId:e,shareToken:(0,c.$6)(),createdAt:s,updatedAt:s}),a.push(i)}),await r.commit();let i=a.map(e=>e.id);return console.log(`âœ… Batch created ${i.length} documents`),i}catch(e){throw console.error("âŒ Error batch creating documents:",e),Error(`Failed to batch create documents: ${e instanceof Error?e.message:"Unknown error"}`)}}async updateClientTracking(e,t,r){try{console.log("\uD83D\uDD0D Updating client tracking:",{shareToken:e,foodId:t,clientChecked:r});let a=await this.getDocumentByShareToken(e);if(!a)return console.log("âŒ Document not found for tracking update"),!1;if("published"!==a.status)return console.log("âŒ Cannot update tracking for unpublished document"),!1;let c=a.ingredients.findIndex(e=>e.foodId===t);if(-1===c)return console.log("âŒ Ingredient not found in document:",t),!1;let s=[...a.ingredients];s[c]={...s[c],clientChecked:r};let i=(0,n.JU)(o.db,this.COLLECTION_NAME,a.id);return await (0,n.r7)(i,{ingredients:s,updatedAt:(0,n.Bt)()}),console.log("âœ… Client tracking updated successfully"),!0}catch(e){return console.error("âŒ Error updating client tracking:",e),!1}}constructor(){this.COLLECTION_NAME="ingredient-documents"}}let i=new s},80088:(e,t,r)=>{let n,o;r.d(t,{$6:()=>d,ay:()=>u});var a=r(6005);function c(e){!n||n.length<e?(n=Buffer.allocUnsafe(128*e),a.webcrypto.getRandomValues(n),o=0):o+e>n.length&&(a.webcrypto.getRandomValues(n),o=0),o+=e}function s(e=21){c(e|=0);let t="";for(let r=o-e;r<o;r++)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&n[r]];return t}class i{static generateToken(e=21){return s(e)}static generateShortToken(e=12){return s(e)}static isValidToken(e){return!!e&&"string"==typeof e&&!(e.length<8)&&!(e.length>50)&&/^[A-Za-z0-9_-]+$/.test(e)}static generateCustomToken(e,t=21){return(function(e,t=21){var r;let a,s;return r=t,s=Math.ceil(1.6*(a=(2<<31-Math.clz32(e.length-1|1))-1)*r/e.length),(t=r)=>{let i="";for(;;){var d;let r=(c(d=0|s),n.subarray(o-d,o)),u=s;for(;u--;)if((i+=e[r[u]&a]||"").length>=t)return i}}})(e,t)()}static generateNumericToken(e=8){return this.generateCustomToken("0123456789",e)}}let d=i.generateToken;i.generateShortToken;let u=i.isValidToken;i.generateNumericToken}};