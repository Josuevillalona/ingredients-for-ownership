"use strict";exports.id=370,exports.ids=[370],exports.modules={81370:(e,t,r)=>{let n,o;r.d(t,{H:()=>h});var a=r(76),c=r(76025),s=r(92476),i=r(6005);function l(e){!n||n.length<e?(n=Buffer.allocUnsafe(128*e),i.webcrypto.getRandomValues(n),o=0):o+e>n.length&&(i.webcrypto.getRandomValues(n),o=0),o+=e}function u(e=21){l(e|=0);let t="";for(let r=o-e;r<o;r++)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&n[r]];return t}class d{static generateToken(e=21){return u(e)}static generateShortToken(e=12){return u(e)}static isValidToken(e){return!!e&&"string"==typeof e&&!(e.length<8)&&!(e.length>50)&&/^[A-Za-z0-9_-]+$/.test(e)}static generateCustomToken(e,t=21){return(function(e,t=21){var r;let a,c;return r=t,c=Math.ceil(1.6*(a=(2<<31-Math.clz32(e.length-1|1))-1)*r/e.length),(t=r)=>{let s="";for(;;){var i;let r=(l(i=0|c),n.subarray(o-i,o)),u=c;for(;u--;)if((s+=e[r[u]&a]||"").length>=t)return s}}})(e,t)()}static generateNumericToken(e=8){return this.generateCustomToken("0123456789",e)}}let g=d.generateToken;d.generateShortToken,d.isValidToken,d.generateNumericToken;class h{async createDocument(e,t){try{let r=g(),n=(0,a.Bt)(),o={...t,coachId:e,shareToken:r,createdAt:n,updatedAt:n};console.log("Creating ingredient document with data:",{clientName:o.clientName,coachId:o.coachId,status:o.status,ingredientsCount:o.ingredients.length,shareToken:o.shareToken});let s=await (0,a.ET)((0,a.hJ)(c.db,this.COLLECTION_NAME),o);console.log("âœ… Document created with ID:",s.id);let i=await this.getDocumentById(s.id);if(!i)throw Error("Failed to retrieve created document - document was created but retrieval failed");return console.log("âœ… Document retrieved successfully with proper timestamps"),i}catch(e){throw console.error("âŒ Error creating ingredient document:",e),e instanceof Error&&console.error("Error details:",{name:e.name,message:e.message,stack:e.stack}),Error(`Failed to create ingredient document: ${e instanceof Error?e.message:"Unknown error"}`)}}async getDocument(e,t){try{let r=(0,a.JU)(c.db,this.COLLECTION_NAME,e),n=await (0,a.QT)(r);if(!n.exists())return console.log("Document not found:",e),null;let o={id:n.id,...n.data()};if(o.coachId!==t)return console.log("Access denied: Coach does not own document"),null;if(!(0,s.Yl)(o))return console.error("Invalid document structure:",o),null;return o}catch(e){return console.error("âŒ Error getting document:",e),null}}async getDocumentById(e){try{let t=(0,a.JU)(c.db,this.COLLECTION_NAME,e),r=await (0,a.QT)(t);if(!r.exists())return null;let n={id:r.id,...r.data()};if(!(0,s.Yl)(n))return console.error("Invalid document structure:",n),null;return n}catch(e){return console.error("âŒ Error getting document by ID:",e),null}}async getDocumentByShareToken(e){try{let t=(0,a.IO)((0,a.hJ)(c.db,this.COLLECTION_NAME),(0,a.ar)("shareToken","==",e),(0,a.b9)(1)),r=await (0,a.PL)(t);if(r.empty)return console.log("Document not found for share token"),null;let n=r.docs[0],o={id:n.id,...n.data()};if(!(0,s.Yl)(o))return console.error("Invalid document structure:",o),null;return o}catch(e){return console.error("âŒ Error getting document by share token:",e),null}}async getCoachDocuments(e,t=50){try{let r=(0,a.IO)((0,a.hJ)(c.db,this.COLLECTION_NAME),(0,a.ar)("coachId","==",e),(0,a.Xo)("updatedAt","desc"),(0,a.b9)(t)),n=await (0,a.PL)(r),o=[];return n.forEach(e=>{let t={id:e.id,...e.data()};(0,s.Yl)(t)&&o.push(t)}),console.log(`ðŸ“‹ Retrieved ${o.length} documents for coach ${e}`),o}catch(e){return console.error("âŒ Error getting coach documents:",e),[]}}async updateDocument(e,t,r){try{if(!await this.getDocument(e,t))return console.log("Cannot update: Document not found or access denied"),null;let n=(0,a.JU)(c.db,this.COLLECTION_NAME,e),o={...r,updatedAt:(0,a.Bt)()};return await (0,a.r7)(n,o),await this.getDocument(e,t)}catch(e){return console.error("âŒ Error updating document:",e),null}}async deleteDocument(e,t){try{if(!await this.getDocument(e,t))return console.log("Cannot delete: Document not found or access denied"),!1;let r=(0,a.JU)(c.db,this.COLLECTION_NAME,e);return await (0,a.oe)(r),console.log("âœ… Document deleted successfully:",e),!0}catch(e){return console.error("âŒ Error deleting document:",e),!1}}async regenerateShareToken(e,t){try{if(!await this.getDocument(e,t))return console.log("Cannot regenerate token: Document not found or access denied"),null;let r=g(),n=(0,a.JU)(c.db,this.COLLECTION_NAME,e);return await (0,a.r7)(n,{shareToken:r,updatedAt:(0,a.Bt)()}),console.log("âœ… Share token regenerated successfully"),r}catch(e){return console.error("âŒ Error regenerating share token:",e),null}}async searchDocuments(e,t,r=20){try{let n=await this.getCoachDocuments(e,100),o=t.toLowerCase();return n.filter(e=>e.clientName.toLowerCase().includes(o)).slice(0,r)}catch(e){return console.error("âŒ Error searching documents:",e),[]}}async batchCreateDocuments(e,t){try{let r=(0,a.qs)(c.db),n=[],o=(0,a.Bt)();t.forEach(t=>{let s=(0,a.JU)((0,a.hJ)(c.db,this.COLLECTION_NAME));r.set(s,{...t,coachId:e,shareToken:g(),createdAt:o,updatedAt:o}),n.push(s)}),await r.commit();let s=n.map(e=>e.id);return console.log(`âœ… Batch created ${s.length} documents`),s}catch(e){throw console.error("âŒ Error batch creating documents:",e),Error(`Failed to batch create documents: ${e instanceof Error?e.message:"Unknown error"}`)}}async updateClientTracking(e,t,r){try{console.log("\uD83D\uDD0D Updating client tracking:",{shareToken:e,foodId:t,clientChecked:r});let n=await this.getDocumentByShareToken(e);if(!n)return console.log("âŒ Document not found for tracking update"),!1;if("published"!==n.status)return console.log("âŒ Cannot update tracking for unpublished document"),!1;let o=n.ingredients.findIndex(e=>e.foodId===t);if(-1===o)return console.log("âŒ Ingredient not found in document:",t),!1;let s=[...n.ingredients];s[o]={...s[o],clientChecked:r};let i=(0,a.JU)(c.db,this.COLLECTION_NAME,n.id);return await (0,a.r7)(i,{ingredients:s,updatedAt:(0,a.Bt)()}),console.log("âœ… Client tracking updated successfully"),!0}catch(e){return console.error("âŒ Error updating client tracking:",e),!1}}constructor(){this.COLLECTION_NAME="ingredient-documents"}}new h},92476:(e,t,r)=>{r.d(t,{Yl:()=>o});var n=r(76);function o(e){let t="object"==typeof e&&"string"==typeof e.id&&"string"==typeof e.clientName&&"string"==typeof e.coachId&&(e.createdAt instanceof n.EK||null!=e.createdAt)&&(e.updatedAt instanceof n.EK||null!=e.updatedAt)&&"string"==typeof e.shareToken&&Array.isArray(e.ingredients)&&["draft","published"].includes(e.status);return t||console.log("Invalid IngredientDocument:",{hasId:"string"==typeof e.id,hasClientName:"string"==typeof e.clientName,hasCoachId:"string"==typeof e.coachId,hasCreatedAt:e.createdAt instanceof n.EK||null!=e.createdAt,hasUpdatedAt:e.updatedAt instanceof n.EK||null!=e.updatedAt,hasShareToken:"string"==typeof e.shareToken,hasIngredients:Array.isArray(e.ingredients),hasValidStatus:["draft","published"].includes(e.status),actualData:e}),t}}};