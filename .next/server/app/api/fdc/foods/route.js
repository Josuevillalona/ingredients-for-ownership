"use strict";(()=>{var e={};e.id=652,e.ids=[652],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},9523:e=>{e.exports=require("dns")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},85158:e=>{e.exports=require("http2")},41808:e=>{e.exports=require("net")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},77282:e=>{e.exports=require("process")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},40370:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>y,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f});var a={};t.r(a),t.d(a,{POST:()=>l});var s=t(49303),o=t(88716),i=t(60670),n=t(87070),d=t(26645);async function u(e){try{let r=e.headers.get("authorization");if(!r?.startsWith("Bearer "))return!1;return r.substring(7).length>0}catch(e){return console.error("Auth verification error:",e),!1}}async function l(e){try{if(!await u(e))return n.NextResponse.json({error:"Authentication required"},{status:401});if(!d.V.isAvailable())return n.NextResponse.json({error:"FDC API service is not configured"},{status:503});let r=await e.json();if(!Array.isArray(r.fdcIds)||0===r.fdcIds.length)return n.NextResponse.json({error:"fdcIds array is required and must not be empty"},{status:400});let t=r.fdcIds.map(e=>{let r=parseInt(e);if(isNaN(r)||r<=0)throw Error(`Invalid FDC ID: ${e}`);return r});if(t.length>20)return n.NextResponse.json({error:"Maximum 20 FDC IDs allowed per request"},{status:400});let a=r.format||"abridged",s=Array.isArray(r.nutrients)?r.nutrients.map(e=>parseInt(e)).filter(e=>!isNaN(e)):void 0,o=await d.V.getFoods({fdcIds:t,format:a,nutrients:s}),i=await Promise.all(o.map(async e=>{let r=await d.V.convertToFoodItem(e,"temp-coach-id");return{fdcDetail:e,foodItem:r}}));return n.NextResponse.json({success:!0,data:i,meta:{requestedIds:t,foundCount:o.length,format:a,convertedAt:new Date().toISOString()}})}catch(e){if(console.error("FDC foods batch error:",e),e instanceof Error){if(e.message.includes("Invalid FDC ID"))return n.NextResponse.json({error:"Invalid request",details:e.message},{status:400});if(e.message.includes("FDC API"))return n.NextResponse.json({error:"External service error",details:"Food database temporarily unavailable"},{status:503})}return n.NextResponse.json({error:"Internal server error"},{status:500})}}let c=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/fdc/foods/route",pathname:"/api/fdc/foods",filename:"route",bundlePath:"app/api/fdc/foods/route"},resolvedPagePath:"C:\\Users\\josue\\Documents\\Builds\\ingredients-for-ownership\\src\\app\\api\\fdc\\foods\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:f,serverHooks:h}=c,g="/api/fdc/foods/route";function y(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:f})}},26645:(e,r,t)=>{t.d(r,{V:()=>o,v:()=>s});var a=t(93820);class s{constructor(){this.baseUrl="https://api.nal.usda.gov/fdc",this.apiKey=process.env.FDC_API_KEY||"",this.apiKey||console.warn("FDC_API_KEY not found. FDC integration will be disabled.")}isAvailable(){return!!this.apiKey}async searchFoods(e){if(!this.isAvailable())throw Error("FDC API is not configured");try{let r=new URLSearchParams({api_key:this.apiKey,query:e.query,pageSize:e.pageSize?.toString()||"50",pageNumber:e.pageNumber?.toString()||"0"});e.dataType?.length&&e.dataType.forEach(e=>{r.append("dataType",e)}),e.sortBy&&r.set("sortBy",e.sortBy),e.sortOrder&&r.set("sortOrder",e.sortOrder),e.brandOwner&&r.set("brandOwner",e.brandOwner);let t=await fetch(`${this.baseUrl}/v1/foods/search?${r}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw Error(`FDC API error: ${t.status} ${t.statusText}`);let a=await t.json();return this.validateSearchResult(a)}catch(e){throw console.error("Error searching FDC foods:",e),Error("Failed to search foods in FDC database")}}async getFoods(e){if(!this.isAvailable())throw Error("FDC API is not configured");try{let r=await fetch(`${this.baseUrl}/v1/foods?api_key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fdcIds:e.fdcIds,format:e.format||"abridged",nutrients:e.nutrients})});if(!r.ok)throw Error(`FDC API error: ${r.status} ${r.statusText}`);let t=await r.json();return Array.isArray(t)?t:[]}catch(e){throw console.error("Error fetching FDC foods:",e),Error("Failed to fetch detailed food information")}}async getFood(e,r="abridged"){if(!this.isAvailable())throw Error("FDC API is not configured");try{let t=new URLSearchParams({api_key:this.apiKey,format:r}),a=await fetch(`${this.baseUrl}/v1/food/${e}?${t}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(404===a.status)return null;if(!a.ok)throw Error(`FDC API error: ${a.status} ${a.statusText}`);return await a.json()}catch(e){throw console.error("Error fetching FDC food:",e),Error("Failed to fetch food information")}}async searchFoodsEnhanced(e,r=!0){let t=await this.searchFoods(e);return r?t.foods.map(e=>this.enhanceFoodItem(e)):t.foods.map(e=>({...e}))}async convertToFoodItem(e,r){let t=this.enhanceFoodItem(e),s=this.extractNutritionalInfo(e);return{name:this.cleanFoodName(e.description),category:t.category||"yellow",description:this.generateDescription(e),servingSize:this.generateServingSize(e),portionGuidelines:t.portionGuidelines||this.generatePortionGuidelines(t.category||"yellow"),nutritionalInfo:s,fdcId:e.fdcId,isGlobal:!1,coachId:r,tags:t.tags||this.generateTags(e),createdAt:a.EK.now(),lastUpdated:a.EK.now()}}validateSearchResult(e){if(!e||"object"!=typeof e)throw Error("Invalid search result format");return{foodSearchCriteria:e.foodSearchCriteria||{},totalHits:e.totalHits||0,currentPage:e.currentPage||0,totalPages:e.totalPages||0,foods:Array.isArray(e.foods)?e.foods:[]}}enhanceFoodItem(e){let r=this.assignColorCategory(e),t=this.calculateConfidence(e,r),a=this.generatePortionGuidelines(r),s=this.generateTags(e);return{...e,category:r,confidence:t,portionGuidelines:a,tags:s}}assignColorCategory(e){let r=e.description?.toLowerCase()||"",t=e.dataType,a=e.brandOwner?.toLowerCase()||"",s=e.ingredients?.toLowerCase()||"";return["candy","chocolate","cookies","cake","ice cream","soda","chips","fries","pizza","burger","fried","processed","refined","sugar","syrup","white bread","donut","pastry"].some(e=>r.includes(e))?"red":["spinach","kale","broccoli","cauliflower","asparagus","salmon","tuna","cod","halibut","sardines","chicken breast","turkey breast","egg whites","bell pepper","cucumber","zucchini","lettuce","herbs","spices","tea","water"].some(e=>r.includes(e))||("Foundation"===t||"SR Legacy"===t)&&(r.includes("raw")||r.includes("fresh"))?"blue":"Branded"===t?a.includes("organic")||s.includes("organic")?"yellow":"red":(["rice","quinoa","oats","bread","pasta","nuts","seeds","avocado","olive oil","beans","lentils","chickpeas","sweet potato","banana","apple"].some(e=>r.includes(e)),"yellow")}calculateConfidence(e,r){let t=.5;return("Foundation"===e.dataType||"SR Legacy"===e.dataType)&&(t+=.3),"Branded"!==e.dataType||e.ingredients||(t-=.2),e.foodNutrients?.length>0&&(t+=.2),Math.max(0,Math.min(1,t))}generatePortionGuidelines(e){switch(e){case"blue":return"Unlimited - use freely as the base of meals and snacks";case"yellow":default:return"Moderate portions - include as part of balanced meals";case"red":return"Limited portions - occasional treats or special occasions only"}}generateTags(e){let r=[],t=e.description?.toLowerCase()||"";return e.dataType&&r.push(e.dataType.toLowerCase().replace(/[^a-z]/g,"-")),t.includes("organic")&&r.push("organic"),t.includes("raw")&&r.push("raw"),t.includes("fresh")&&r.push("fresh"),t.includes("frozen")&&r.push("frozen"),t.includes("canned")&&r.push("canned"),t.includes("dried")&&r.push("dried"),e.brandOwner&&r.push("branded"),r.slice(0,10)}cleanFoodName(e){return e.replace(/\b(raw|fresh|frozen|canned|dried)\b/gi,"").replace(/\s+/g," ").trim()}generateDescription(e){let r=e.description;return e.brandOwner&&(r+=` (${e.brandOwner})`),"Foundation"===e.dataType&&(r+=" - USDA Foundation Food"),r}generateServingSize(e){if(e.servingSize&&e.servingSizeUnit)return`${e.servingSize} ${e.servingSizeUnit}`;let r=e.description?.toLowerCase()||"";return r.includes("vegetable")||r.includes("fruit")?"1 cup":r.includes("meat")||r.includes("fish")||r.includes("poultry")?"4 oz (palm-sized portion)":r.includes("nuts")||r.includes("seeds")?"1 oz (small handful)":r.includes("oil")?"1 tablespoon":"1 serving"}extractNutritionalInfo(e){let r={calories:0,protein:0,carbs:0,fat:0,fiber:0};if(e.labelNutrients)return r.calories=e.labelNutrients.calories?.value||0,r.protein=e.labelNutrients.protein?.value||0,r.carbs=e.labelNutrients.carbohydrates?.value||0,r.fat=e.labelNutrients.fat?.value||0,r.fiber=e.labelNutrients.fiber?.value||0,r;if(e.foodNutrients)for(let t of e.foodNutrients){let e=t.name?.toLowerCase()||"",a=t.number;208===a||e.includes("energy")||e.includes("calories")?r.calories=t.amount||0:203===a||e.includes("protein")?r.protein=t.amount||0:205===a||e.includes("carbohydrate")?r.carbs=t.amount||0:204===a||e.includes("total lipid")||e.includes("fat")?r.fat=t.amount||0:(291===a||e.includes("fiber"))&&(r.fiber=t.amount||0)}return r}}let o=new s}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[948,972,827],()=>t(40370));module.exports=a})();